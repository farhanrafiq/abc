<!-- Product Card Partial -->
<article class="product-card" itemscope itemtype="https://schema.org/Book">
    <a href="{{ url_for('web.product_detail', slug=product.slug) }}" class="product-link" aria-label="View {{ product.title }}">
        
        <!-- Product Image -->
        <div class="product-image">
            {% if product.cover_image %}
                <img src="{{ url_for('static', filename='uploads/products/' + product.cover_image) }}" 
                     alt="{{ product.title }}" 
                     loading="lazy"
                     itemprop="image">
            {% else %}
                <img src="https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" 
                     alt="{{ product.title }}" 
                     loading="lazy"
                     itemprop="image">
            {% endif %}
            
            <!-- Product Badges -->
            {% if show_price_badges and product.price and product.price.sale_inr < product.price.mrp_inr %}
                {% set discount_pct = ((product.price.mrp_inr - product.price.sale_inr) / product.price.mrp_inr * 100) | round %}
                <div class="product-badge">{{ discount_pct }}% OFF</div>
            {% elif product.is_bestseller %}
                <div class="product-badge">Bestseller</div>
            {% elif product.is_new %}
                <div class="product-badge">New</div>
            {% endif %}
        </div>
        
        <!-- Product Content -->
        <div class="product-content">
            <!-- Category -->
            {% if product.categories %}
                <div class="product-category" itemprop="genre">{{ product.categories[0].name }}</div>
            {% endif %}
            
            <!-- Title -->
            <h3 class="product-title" itemprop="name">{{ product.title }}</h3>
            
            <!-- Author -->
            {% if product.authors %}
                <p class="product-author">
                    <span>by</span>
                    {% for author in product.authors %}
                        <span itemprop="author">{{ author.name }}</span>{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
            {% endif %}
            
            <!-- Rating -->
            {% if product.average_rating and product.review_count > 0 %}
                <div class="product-rating" itemscope itemtype="https://schema.org/AggregateRating">
                    <div class="rating-stars" aria-label="Rating: {{ product.average_rating }} out of 5 stars">
                        {% for i in range(1, 6) %}
                            {% if i <= product.average_rating %}
                                <i class="fas fa-star" style="color: var(--orange-600);"></i>
                            {% elif i - 0.5 <= product.average_rating %}
                                <i class="fas fa-star-half-alt" style="color: var(--orange-600);"></i>
                            {% else %}
                                <i class="far fa-star" style="color: var(--muted);"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-count">
                        (<span itemprop="ratingValue">{{ product.average_rating }}</span>) 
                        <span itemprop="reviewCount">{{ product.review_count }}</span> reviews
                    </span>
                    <meta itemprop="bestRating" content="5">
                    <meta itemprop="worstRating" content="1">
                </div>
            {% endif %}
            
            <!-- Price and Actions -->
            {% if product.price %}
                <div class="product-price" itemscope itemtype="https://schema.org/Offer">
                    <div class="price-container">
                        <span class="price-current" itemprop="price" content="{{ product.price.sale_inr / 100 }}">
                            ₹{{ "%.0f"|format(product.price.sale_inr / 100) }}
                        </span>
                        {% if product.price.mrp_inr > product.price.sale_inr %}
                            <span class="price-original">₹{{ "%.0f"|format(product.price.mrp_inr / 100) }}</span>
                        {% endif %}
                        <meta itemprop="priceCurrency" content="INR">
                        <meta itemprop="availability" content="https://schema.org/InStock">
                    </div>
                    
                    <button class="add-to-cart-btn" 
                            data-product-id="{{ product.id }}"
                            onclick="event.preventDefault(); event.stopPropagation(); addToCart({{ product.id }});"
                            aria-label="Add {{ product.title }} to cart">
                        <i class="fas fa-cart-plus"></i>
                    </button>
                </div>
            {% endif %}
        </div>
    </a>
    
    <!-- Schema.org structured data -->
    <meta itemprop="isbn" content="{{ product.isbn }}">
    <meta itemprop="numberOfPages" content="{{ product.pages }}">
    <meta itemprop="bookFormat" content="https://schema.org/{{ product.format }}">
    <meta itemprop="inLanguage" content="{{ product.language }}">
    {% if product.published_at %}
        <meta itemprop="datePublished" content="{{ product.published_at.isoformat() }}">
    {% endif %}
    {% if product.publisher %}
        <span itemprop="publisher" itemscope itemtype="https://schema.org/Organization" style="display: none;">
            <meta itemprop="name" content="{{ product.publisher.name }}">
        </span>
    {% endif %}
</article>