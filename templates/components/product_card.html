<div class="product-card h-100">
    <div class="card border-0 shadow-sm h-100">
        <!-- Product Image -->
        <div class="product-image-container position-relative">
            {% if product.cover_image %}
                <img src="{{ url_for('static', filename='uploads/products/' + product.cover_image) }}" 
                     class="card-img-top product-image" 
                     alt="{{ product.title }}"
                     loading="lazy">
            {% else %}
                <img src="{{ url_for('static', filename='images/default-book-cover.jpg') }}" 
                     class="card-img-top product-image" 
                     alt="{{ product.title }}"
                     loading="lazy">
            {% endif %}
            
            <!-- Badges -->
            <div class="product-badges position-absolute top-0 start-0 m-2">
                {% if product.is_new %}
                    <span class="badge bg-success">New</span>
                {% endif %}
                {% if product.sale_price and product.sale_price < product.mrp %}
                    <span class="badge bg-danger">Sale</span>
                {% endif %}
                {% if product.is_bestseller %}
                    <span class="badge bg-warning text-dark">Bestseller</span>
                {% endif %}
            </div>

            <!-- Quick Actions -->
            <div class="product-actions position-absolute top-0 end-0 m-2">
                <div class="btn-group-vertical">
                    <button class="btn btn-outline-light btn-sm quick-view-btn" 
                            data-product-id="{{ product.id }}" 
                            title="Quick View">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-light btn-sm wishlist-btn" 
                            data-product-id="{{ product.id }}" 
                            title="Add to Wishlist">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Product Info -->
        <div class="card-body d-flex flex-column">
            <!-- Category & Language -->
            <div class="product-meta mb-2">
                {% if product.category %}
                <span class="badge bg-brand-light text-brand-brown me-2">
                    {{ product.category.name }}
                </span>
                {% endif %}
                {% if product.language %}
                <span class="badge bg-light text-muted">
                    {{ product.language }}
                </span>
                {% endif %}
            </div>

            <!-- Title -->
            <h6 class="card-title product-title mb-2">
                <a href="{{ url_for('web.product_detail', slug=product.slug) }}" 
                   class="text-decoration-none text-dark">
                    {{ product.title }}
                </a>
            </h6>

            <!-- Author -->
            {% if product.author %}
            <p class="product-author text-muted mb-2">
                <small>by {{ product.author.name }}</small>
            </p>
            {% endif %}

            <!-- Rating -->
            {% if product.average_rating %}
            <div class="product-rating mb-2">
                <div class="stars">
                    {% for i in range(1, 6) %}
                        {% if i <= product.average_rating %}
                            <i class="fas fa-star text-warning"></i>
                        {% elif i - 0.5 <= product.average_rating %}
                            <i class="fas fa-star-half-alt text-warning"></i>
                        {% else %}
                            <i class="far fa-star text-warning"></i>
                        {% endif %}
                    {% endfor %}
                    <small class="text-muted ms-1">({{ product.review_count or 0 }})</small>
                </div>
            </div>
            {% endif %}

            <!-- Description -->
            {% if product.description %}
            <p class="product-description text-muted small mb-3">
                {{ product.description[:100] }}...
            </p>
            {% endif %}

            <!-- Price -->
            <div class="product-price mt-auto mb-3">
                {% if product.price %}
                    {% if product.price.sale_price and product.price.sale_price < product.price.mrp %}
                        <div class="price-container">
                            <span class="current-price h6 text-brand-orange fw-bold mb-0">
                                ₹{{ "%.2f"|format(product.price.sale_price / 100) }}
                            </span>
                            <span class="original-price text-muted text-decoration-line-through ms-2">
                                ₹{{ "%.2f"|format(product.price.mrp / 100) }}
                            </span>
                            <span class="discount-percent badge bg-success ms-2">
                                {{ "%.0f"|format((1 - product.price.sale_price / product.price.mrp) * 100) }}% OFF
                            </span>
                        </div>
                    {% else %}
                        <span class="current-price h6 text-brand-orange fw-bold mb-0">
                            ₹{{ "%.2f"|format(product.price.mrp / 100) }}
                        </span>
                    {% endif %}
                {% else %}
                    <span class="text-muted">Price not available</span>
                {% endif %}
            </div>

            <!-- Stock Status -->
            <div class="stock-status mb-3">
                {% if product.inventory and product.inventory.quantity > 0 %}
                    {% if product.inventory.quantity <= product.inventory.low_stock_threshold %}
                        <small class="text-warning">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Only {{ product.inventory.quantity }} left!
                        </small>
                    {% else %}
                        <small class="text-success">
                            <i class="fas fa-check-circle me-1"></i>
                            In Stock
                        </small>
                    {% endif %}
                {% else %}
                    <small class="text-danger">
                        <i class="fas fa-times-circle me-1"></i>
                        Out of Stock
                    </small>
                {% endif %}
            </div>

            <!-- Actions -->
            <div class="product-actions">
                {% if product.inventory and product.inventory.quantity > 0 %}
                    <button class="btn btn-brand-primary w-100 add-to-cart-btn" 
                            data-product-id="{{ product.id }}"
                            data-product-title="{{ product.title }}">
                        <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                    </button>
                {% else %}
                    <button class="btn btn-outline-secondary w-100" disabled>
                        <i class="fas fa-times me-2"></i>Out of Stock
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>